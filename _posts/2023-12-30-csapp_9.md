---
title: "CSAPP(9) - Virtual Memory"
excerpt: "Computer Systems : A Programmer’s Perspective - 7장"

categories:
  - cs
  - os
tags:
  - csapp
last_modified_at: 2023-12-30T08:00:00-08:00
---

메모리를 여러 프로세스가 공유하면 CPU사용량이 늘어나고 에러를 발생시킬 수 있다.
메모리를 효율적으로 사용하고 에러를 줄이기 위해 현대 시스템은 virtual memory라는 가상 메모리 추상화를 제공한다.
가상 메모리는 커널 소프트웨어가 각 프로세스에게 제공하는 크고, 균일하고, 개인적인 주소 공간이다.

가상 메모리의 능력
- 메모리를 디스크에 저장된 주소 공간의 캐시처럼 사용.
  - 활성화된 영역만 메모리에 올린다.
- 메모리 관리의 단순화
  - 각 프로세스에 균일한 주소 공간을 제공
- 각 프로세스의 주소 공간이 충돌하지 않도록 보호

# 1. Physical and Virtual Addressing
CPU가 물리 주소를 사용하여 메모리의 접근하는 방식을 물리 어드레싱이라 한다.

현대 프로세스는 가상 어드레싱을 사용한다.

![](https://miro.medium.com/v2/resize:fit:1400/format:webp/0*yTK1-G_UOlbgW9zJ)
- 주소 변환 : 가상 주소를 물리 주소로 바꾸는 것
  - Memory Management Unit(MMU)는 CPU칩 내에 있으며, OS에 의해 관리되는 룩업 테이블(메모리에 존재)를 사용해서 변환

# 2. Address Spaces
각 데이터 개체는 여러 독립적인 주소를 가진다.
- 메모리의 각 바이트는 가상 주소 공간의 가상 주소와 물리 주소 공간의 물리 주소를 가진다.

# 3. VM as a Tool for Caching
개념적으로, 가상 메모리는 디스크에 있는 N개의 연속된 바이트 크기 셀의 배열로 구성된다.
- 각 바이트는 고유한 가상 주소를 갖고, 이게 배열의 인덱스다.
- 디스크 내 배열의 내용은 메모리에 캐시된다
  - 디스크의 데이터는 블락이라는 단위로 쪼개져 메모리로 전송된다. VM 시스템은 가상 메모리를 virtual page라는 고정 크기 블락으로 쪼갠다. 물리 메모리 또한 physical page로 쪼갠다.

가상 페이지 집합은 세개로 나뉜다.
- *Unallocated* : VM에 의해 할당되지 않은 페이지. 데이터도 없고, 디스크 공간을 점유하지 않음
- *Cached* : 물리 메모리에 캐시된 페이지.
- *Uncached* : 물리 메모리에 캐시되지 않은 패이지.

# 3.1. DRAM Cache Organication
DRAM 캐시란 VM 시스템의 가상 페이지를 말한다. 
- DRAM 캐시 미스는 SRAM 미스에 비해 비용이 크다(속도가 느리다)
- 페널티가 크기 때문에 가상 페이지는 크다. (4KB~2MB) 또한 같은 이유로 write-through 대신 write-back을 사용한다.(쓰기 연산을 미룬다.)