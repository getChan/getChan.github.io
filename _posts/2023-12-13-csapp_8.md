---
title: "CSAPP(8) - Exceptional Control Flow"
excerpt: "Computer Systems : A Programmer’s Perspective - 8장"

categories:
  - cs
tags:
  - csapp
last_modified_at: 2023-12-13T08:00:00-08:00
---

- 제어 흐름의 가장 간단한 종류는 "smooth" 시퀀스다. 인접한 메모리에 있는 명령어들을 순차적으로 실행하는 것. 
- 인접하지 않은 명령어를 수행해야 할 때도 있다. jump, call, return 등. 
- 시스템은 프로그램 내에서 일어나지 않는 변화에 대해서도 반응할 수 있어야 한다. 
  - 하드웨어 타이머, 패킷이 도착해서 메모리에 올려야 할 때, 디스크에 데이터를 요청하고 기다릴 때 등.
  - 앞으로 이를 exceptional contol flow(ECF)라 부르겠다.
  - 하드웨어 수준에서는 하드웨어 트리거에 의해 이벤트가 감지되어 예외 핸들러에게 제어를 전달하고
  - OS수준에서는 커널이 context switching으로 한 유저 프로세스의 제어를 다른 유저 프로세스로 전달한다.
  - 애플리케이션 수준에서는 한 프로세스가 다른 프로세스에 signal을 보낼 수 있다. 시그널은 수신자의 시그널 핸들러로 제어를 전달한다.
  - 개별 프로그램은 에러 발생 시 다른 함수의 임의 위치로 점프할 수 있다.

# 1. Exceptions
- 예외는 ECF중 하나로 일부는 하드웨어, 일부는 OS에 구현되어 있다.
- 일부는 하드웨어에 구현되어 있어서 시스템에 따라 디테일이 다르다. 다만 기본 아이디어는 동일하다.

![](https://img-blog.csdnimg.cn/bf716a4ec38049dca5755551ee5424af.png)
- 이벤트는 가상 메모리 페이지 폴트, 산술 오버플로, divide by zero와 같이 현재 명령어 실행과 관계있을 수도 있고
- 시스템 타이머, 입출력 요청 완료와 같이 관계없을수도 있다.

프로세서가 이벤트 발생을 감지하면 exception table을 통해서 exception handler를 호출한다. 예외 핸들러가 처리를 끝내면 아래 세 가지 중 하나를 한다.
1. 핸들러는 제어를 이벤트 발생 시점의 명령어로 반환한다.
2. 핸들러는 제어를 이벤트 발생 시점의 명령어 다음 명령어로 반환한다.
3. 핸들러는 프로그램을 중단한다.

## 1.1. Exception handling