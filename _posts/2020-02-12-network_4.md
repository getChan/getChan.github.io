---
title: "네트워크(4)-라우팅"
excerpt: "컴퓨터공학을 정리해봅니다."

categories:
  - cs
tags:
  - computer science
  - network
last_modified_at: 2020-02-12T08:06:00-05:00
---

> 책 `<하루 3분 네트워크 교실 >, 아미노 에이지` 을 읽고 정리한 내용입니다
>
> [1. 네트워크 기초 지식](/cs/network_1)에서는 네트워크 구축과 순서, 단계와 물리 계층을 다루고 있습니다
>
> [2. 신호의 전송과 충돌](/cs/network_2)에서는 데이터링크 계층에 대해 다루고 있습니다.
>
> [3. IP 어드레싱](/cs/network_3)에서는 네트워크 계층의 IP 어드레싱 역할에 대해 다루고 있습니다.

이 포스팅에서는 네트워크 계층의 라우팅에 대해 다뤄봅니다.



# 주소와 경로

## IP 주소와 MAC 주소

**MAC 주소는 같은 네트워크 내에서의 수신처를 결정하고, IP 주소는 수신처의 컴퓨터를 결정한다.**

즉, IP 주소는 데이터의 최종 수신처가 되고 MAC 주소는 그 다음에 정의되는 수신처가 된다.

따라서 MAC 주소는 다음 수신처에 도달하게 되면 그 다음 수신처로 바뀌면서 최종 수신처에 도달한다.

마지막에 IP 주소로 지정되는 최종 수신처에 도달하는 과정을 통해  **경로**가 만들어진다.

![ip address mac address 이미지 검색결과](https://askleo.com/wp-content/uploads/2009/01/macaddress.png)

## 경로

**라우터**가 경로를 결정하는 역할을 한다. 

- 기본적으로 라우터는 **자신의 위치에서 다음 위치까지만 결정**한다.
- Hop-by-Hop

복수의 라우터가 다음 수신처를 결정하는 과정을 반복함으로써 경로를 만든다.

라우터는 **네트워크 경계상에 배치**되어서 다음 수신처를 결정한다.

다음 수신처란 **최종 수신처에 가기 위한 다음 라우터**

**라우터가 없으면 다른 네트워크에 패킷을 보낼 수 없다.**

- 동일 네트워크 수신이면 수신처에 직접 송신한다
- 다른 네트워크 수신이면 **디폴트 게이트웨이**에 설정된 라우터로 송신한다.



# 라우터

라우터는 네트워크의 경계상에 위치하기 때문에 **복수의 인터페이스를 가질 수 있다.**

- 라우터의 각 인터페이스는 각각 서로 다른 네트워크에 소속되어 있다.

라우터의 역할

- 라우팅을 통해 경로를 만든다.
- 복수의 네트워크를 연결한다.
- 패킷을 필터링한다.



## 라우터의 동작

**라우팅 테이블**

- 수신처 네트워크까지의 거리 정보
- 다음 도달하는 라우터 정보
- 다음 라우터에 연결되어 있는 자신의 인터페이스 정보

등이 기재되어 있다.

![routing table 이미지 검색결과](https://t1.daumcdn.net/cfile/tistory/231FE64F5427E7DD28)

다음 수신처는 **최장일치의 룰**로 찾아낸다.

- 수신처 IP주소와 수신처 네트워크 주소의 비트열을 앞에서부터 순서대로 비교해서 가장 많이 일치하는 것부터 선택한다.

![routing table longest prefix match 이미지 검색결과](https://forum.huawei.com/huaweiconnect/data/attachment/forum/201903/06/175309qxzx5p6x4e9559x4.png)

# 디폴트 게이트웨이

## 브로트캐스트 도메인

브로드캐스트가 도달하는 범위를 **브로드캐스트 도메인**이라 한다. 브로드캐스트는 라우터를 넘어서 전송할 수 없기 때문에 라우터는 브로드캐스트 도메인을 나누는 역할을 한다.

> 충돌 도메인을 나누는 역할은 스위치가 한다.
>
> 허브는 충돌 도메인과 브로드캐스트 도메인 둘 다 영향을 주지 않는다.

브로드캐스트 도메인 == 네트워크



## ARP와 라우터

수신처 MAC 주소를 알아내려면 ARP를 이용해야 하는데, **ARP는 브로드캐스트이다.** 따라서 ARP는 수신처까지 도달할 수 없다.

그렇다면 다른 네트워크에 있는 컴퓨터의 MAC 주소는 어떻게 알까??



## 디폴트 게이트웨이

**일단, 디폴트 게이트웨이로 패킷을 보내서 다른 네트워크로 전송한다.**

즉, 컴퓨터가 다른 네트워크에 데이터를 송신할 경우 MAC수신처는 디폴트 게이트웨이의 MAC 주소가 된다. (**디폴트 게이트웨이로 ARP를 수행한다.**)

- 동일 네트워크라면 IP 수신처로 ARP를 수행해서 수신 MAC 주소를 얻게 된다.

컴퓨터는 수동 혹은 DHCP를 통해 디폴트 게이트웨이의 IP주소를 미리 설정해 둔다. 

<img src="https://i.ytimg.com/vi/lO31_zPHLNk/maxresdefault.jpg" alt="arp default gateway 이미지 검색결과" style="zoom: 50%;" />

# 라우팅

## 라우팅 테이블

- 수신처 네트워크
- 다음 라우터
- 메트릭
- 인터페이스

가 기재되어 있다.

라우팅 테이블에 수신처가 없을 경우애는 **수신처 불명으로 패킷을 파기한다.**



## 2개의 라우팅

라우터는 최적의 경로를 찾기 위해 다른 네트워크 경로를 모두 알아야 한다.

알고 있는 경로 중 최적의 경로를 선택해서 라우팅 테이블을 작성한다.

정적 라우팅

- 관리자가 수동으로 경로를 입력하는 방법
- 입력한 경로를 사용할 수 없게 되는 경우 수동으로 경로를 다시 설정해야 한다.

**동적 라우팅**

- 라우터가 자동으로 정보를 서로 교환해서 최적의 경로를 알아내는 방법
- 정보 교환 과정에서 오버헤드가 늘어남
- **모든 라우터가 동일한 정보를 가져야 한다.**(컨버전스)



# 라우팅 프로토콜

## 자율화 시스템

**라우팅 프로토콜**

- 근접해 있는 라우터 간의 네트워크 정보를 서로 교환하기 위한 규칙
- 교환한 정보를 근거로 라우팅 테이블을 변경한다.

**자율화 시스템 Autonomous System**

- 하나의 관리 단체에 의해 관리되는 네트워크 집합체
- 복수의 네트워크를 통합해서 큰 단위의 라우팅을 수행한다.



## 라우팅 프로토콜의 종류

AS간 라우팅 (EGP, Externel Gateway Protocol)

- BGP 프로토콜이 표준

AS 내부 라우팅 (IGP, Internel Gateway Protocol)

- 각 AS에서 관리자가 프로토콜을 선택한다.

라우팅을 행하는 규모나 동작에 따라 라우팅 프로토콜은 여러 종류가 있다.



## 라우팅 프로토콜의 역할

근접해 있는 라우터 간의 네트워크 정보 교환 시에

- 언제 정보교환을 할지
- 어떻게 할지
- 누구에게 전송할지
- 어떤 정보를 전송할지

를 결정한다.

정보 교환을 통해 **컨버전스**상태에 도달한다.

교환한 경로 정보를 기준으로 최적의 경로를 라우팅 테이블에 기재한다. 이를 통해 항상 최적의 경로가 사용 가능하다.



# RIP

## 메트릭

**최적의 경로를 결정할 때의 판단기준**

최소 메트릭 값을 갖는 것을 최적의 경로로 결정한다.



## RIP 

*routing information protocol*

디스턴스벡터형 라우팅 프로토콜

라우터간 정보 교환을 RIP에서는 **라우팅 업데이트**라고 한다.

**라우팅 테이블을 그대로 교환한다.**

- 30초에 한번
- 업데이트를 6번 수신받지 않으면 장애 발생으로 판단해서 해당 라우터를 사용하는 경로들을 파기한다.

메트릭으로 홉 수를 사용한다

- 수신처 네트워크까지 통과하는 라우터 수

업데이트를 수신하면, 자기가 모르는 네트워크를 테이블에 추가한다. 업데이트를 보내온 라우터를 그 앞의 네트워크에의 중계 라우터로, 업데이트를 받은 인터페이스를 그 앞의 네트워크에의 송신 인터페이스로 정한다.

이미 테이블에 존재하는 네트워크에 대해서 새로운 정보가 업데이트되어 새로운 경로 쪽이 메트릭이 작으면 그쪽을 테이블에 기재한다.



# ICMP

*Internet Control Message Protocol*

**에러 보고 프로토콜**. 네트워크의 제어. 관리 등을 수행하는 프로토콜

IP 패킷의 페이로트에는 보통 TCP or UDP 가 들어감. ICMP는 ICMP 메세지를 페이로드에 넣는다.



## ICMP의 종류

**Query 메세지**

- 상태를 조사하기 위해 사용되는 메시지

**Error 메세지**

- 에러를 통직하기 위한 메시지

<img src="https://miro.medium.com/max/2468/1*_GK8lxZws3JZNyHtJMEg5A.png" alt="ICMP 이미지 검색결과" style="zoom: 33%;" />

## TTL 

*Time To Live*

**IP 패킷의 TTL은 라우터를 경유할 때마다 1만큼씩 줄어들고, 0이 되면 패킷은 파기된다.**



# Echo / Time Exceeded

## Echo

ICMP 타입 0이 Echo reply, 타입 8은 Echo request

송신측은 Echo request, 수신한 컴퓨터는 Echo reply하는 구조

`ping`명령어가 대표적

송신처와 수신처 간 데이터를 송수신할 수 있다.

네트워크 상태를 조사할 수 있다.



## Time Exceeded

'시간초과에 의한 패킷 파기'

TTL에 의해 파기한 것을 통지하는 메시지

`traceroute`

- 수신처에 도달하기까지 경유하는 라우터를 가르쳐준다.
- 거쳐간 경로를 알 수 있다.



