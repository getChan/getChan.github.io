---
title: "CSAPP(5) - Optimizing Program Performance"
excerpt: "Computer Systems : A Programmer’s Perspective - 5장"

categories:
  - cs
tags:
  - csapp
last_modified_at: 2023-11-01T08:00:00-08:00
---

프로그램의 주 목적은 모든 조건에서 정확하게 동작하는 것이다. 또한 프로그래머는 깔끔하고 간결한 코드를 작성해야 한다. 
반면에 성능 개선이 필요한 경우도 있다. 이번 장에서는 어떻게 프로그램을 최적화해서 빠르게 만들 수 있는지 알아본다.

프로그래머는 컴파일러가 효율적으로 최적화하도록 소스코드를 작성해야 한다. 

# 1. Capabilities and Limitations of Optimizing Compilers
컴파일러가 대부분의 최적화를 도와주지만, 그럴 수 없는 경우도 있다. 때문에 코드 작성 시에 함수는 size effect가 없게(전역 상태를 참조하지 않게) 하는 게 좋겠다. 

# 2. Expressing Program Performance
CPE(cycles per element) 방식으로 함수 성능을 측정한다.

# 3. Program Example

# 4. Eliminating Loop Inefficiencies
- code motion
  - 루프 순회 시 반복된 계산을 앞으로 빼는 것
    - 문자열 길이까지 순회하는 경우 등
  - 컴파일러가 최적화하지 못하는 경우도 있으니 프로그래밍해주자.

# 5. Reducing Procedure Calls
- 순회 할 때마다 함수 콜하는 것보다, 반복문 내에서는 가능하다면 함수 호출을 줄이자.
- 모듈화를 손상시킬 수는 있다.
- 책 내 예제에서는 성능 향상을 보이지 못했다. 뒷 장에서 설명해준다고 함.

# 6. Eliminating Unneeded Memory References
- 순회 할 때마다 포인터 역참조 등으로 메모리 데이터를 변경하는 것은 비효율적이다.
- 축적된 값을 지연 변수로 선언해서 메모리 접근을 줄이자.

# 7. Understanding Modern Processors
> 코드 레벨을 넘어 각 머신 레벨의 최적화를 하려면 프로세서 구조를 알아야 한다. 
> 나중에 보기로...

# 8. Loop Unrolling
- 루프 언롤링이란 매 순회 시 계산하는 요소의 수를 증가시켜 전체 순회 개수를 줄이는 방법이다.
- 한 루프 당 계산하는 요소의 수를 k개로 정하는데, 2개 이상은 큰 최적화 효과가 없다.
- 2개로 하더라도 큰 최적화를 기대할 수는 없다.
  - 프로세서 수준에서는 전체를 순회하는 것과 큰 차이가 나지 않는다. 이전 작업 완료를 기다려야 함.

# 9. Enhancing Parallelism

## 9.1. Multiple Accumulators
- 결합 연산(reduce)이 결합법칙과 교환법칙을 만족한다면(덧셈, 곱셈), 전체 집합을 쪼개서 수행하고 병합할 수 있다.
- loop unrolling과 함께 수행 가능
  - `k X k` loop unrolling이라 함.
- 루프 언롤링과 함께 사용 시 성능 향상 된다.
  - 프로세서가 더 이상 이전 작업 수행 완료를 기다리지 않아도 됨. 지연시간 임계점을 넘을 수 있음.
- 컴파일러는 교환/결합법칙만 만족한다면 최적화할 수 있다.
  - 정수 가능, 부동소수점 불가능(2장에서 봄)

## 9.2. Reassociation Transformation

# 출처
- https://csapp.cs.cmu.edu/   
- 책 "Computer Systems : A Programmer’s Perspective"